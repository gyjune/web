<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>咪咕直播源批量生成工具</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f0f2f5;
        }
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #e60012;
            border-bottom: 1px solid #eee;
            padding-bottom: 15px;
            margin-top: 0;
            text-align: center;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #5f6368;
        }
        .example {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
            padding: 5px 10px;
            background-color: #f8f9fa;
            border-left: 3px solid #2196F3;
        }
        .error-message {
            color: #dc3545;
            padding: 10px;
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 4px;
            margin-bottom: 15px;
        }
        .copy-error {
            color: #dc3545;
            margin-top: 10px;
            display: none;
        }
        input[type="text"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            box-sizing: border-box;
        }
        input[type="text"]:focus {
            outline: none;
            border-color: #2196F3;
            box-shadow: 0 0 0 2px rgba(33, 150, 243, 0.25);
        }
        button {
            background-color: #e60012;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover {
            background-color: #c30010;
        }
        #copyBtn {
            background-color: #2196F3;
        }
        #copyBtn:hover {
            background-color: #0b7dda;
        }
        #downloadBtn {
            background-color: #4CAF50;
        }
        #downloadBtn:hover {
            background-color: #45a049;
        }
        .result {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px dashed #eee;
        }
        .url-list {
            list-style: none;
            padding: 0;
            max-height: 400px;
            overflow-y: auto;
            padding-right: 10px;
            /* 移除 columns 属性，改为单列布局 */
        }
        .url-list::-webkit-scrollbar {
            width: 6px;
        }
        .url-list::-webkit-scrollbar-thumb {
            background-color: #ccc;
            border-radius: 3px;
        }
        .url-item {
            margin-bottom: 8px;
            padding: 5px;
            border-radius: 3px;
            transition: background-color 0.2s;
        }
        .url-item:hover {
            background-color: #f8f9fa;
        }
        .url-text {
            color: #333;
            word-break: break-all;
        }
        .copied-notice {
            color: #4CAF50;
            margin-left: 10px;
            display: none;
        }
        .button-group {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            .url-list {
                max-height: 300px;
            }
            .button-group {
                flex-direction: column;
            }
            button {
                width: 100%;
                margin-right: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>咪咕直播源批量生成工具</h1>
        
        <form method="post" id="urlForm">
            <div class="form-group">
                <label for="base_url">请输入基础网址：</label>
                <input type="text" id="base_url" name="base_url" value="" placeholder="例如：http://8.138.7.223/tv/migu.php" required>
                <div class="example">
                    输入示例：http://8.138.7.223/tv/migu.php
                </div>
            </div>
            <button type="submit">生成链接列表</button>
        </form>
        
        <div class="result" id="resultSection" style="display: none;">
            <h2>生成的直播源链接：</h2>
            <div class="button-group">
                <button id="copyBtn">复制所有链接</button>
                <button id="downloadBtn">下载链接文件</button>
            </div>
            <span id="copiedNotice" class="copied-notice">已复制到剪贴板！</span>
            <div id="copyError" class="copy-error">复制失败，请手动选择并复制文本。</div>
            
            <ul class="url-list" id="urlList">
                <!-- 链接将在这里动态生成 -->
            </ul>
            
            <textarea id="generatedContent" style="position: absolute; left: -9999px;"></textarea>
        </div>
    </div>

    <script>
        // 定义咪咕频道ID和名称
        const channels = {
            'cctv1': 'CCTV-1综合',
            'cctv2': 'CCTV-2财经',
            'cctv3': 'CCTV-3综艺',
            'cctv4': 'CCTV-4中文国际',
            'cctv4m': 'CCTV-4欧洲',
            'cctv4o': 'CCTV-4美洲',
            'cctv5': 'CCTV-5体育',
            'cctv5p': 'CCTV-5+体育赛事',
            'cctv6': 'CCTV-6电影',
            'cctv7': 'CCTV-7国防军事',
            'cctv8': 'CCTV-8电视剧',
            'cctv9': 'CCTV-9纪录',
            'cctv10': 'CCTV-10科教',
            'cctv11': 'CCTV-11戏曲',
            'cctv12': 'CCTV-12社会与法',
            'cctv13': 'CCTV-13新闻',
            'cctv14': 'CCTV-14少儿',
            'cctv15': 'CCTV-15音乐',
            'cctv17': 'CCTV-17农业农村',
            'fxzl': 'CCTV发现之旅',
            'lgs': 'CCTV老故事',
            'zxs': 'CCTV中学生',
            'cgtn': 'CGTN',
            'cgtnjl': 'CGTN纪录',
            'cgtne': 'CCTV西班牙语',
            'cgtnf': 'CCTV法语',
            'cgtna': 'CCTV阿拉伯语',
            'cgtnr': 'CCTV俄语',
            'dfws': '东方卫视',
            'cqws': '重庆卫视',
            'jlws': '吉林卫视',
            'lnws': '辽宁卫视',
            'nmws': '内蒙古卫视',
            'nxws': '宁夏卫视',
            'gsws': '甘肃卫视',
            'qhws': '青海卫视',
            'sxws': '陕西卫视',
            'sdws': '山东卫视',
            'hnws': '河南卫视',
            'hubws': '湖北卫视',
            'hunws': '湖南卫视',
            'jxws': '江西卫视',
            'jsws': '江苏卫视',
            'dnws': '东南卫视',
            'hxws': '海峡卫视',
            'gdws': '广东卫视',
            'dwqws': '大湾区卫视',
            'gxws': '广西卫视',
            'ynws': '云南卫视',
            'gzws': '贵州卫视',
            'xjws': '新疆卫视',
            'xzws': '西藏卫视',
            'hinws': '海南卫视',
            'shdy': '四海钓鱼',
            'chcdzdy': 'CHC动作电影',
            'chcjtdy': 'CHC家庭影院',
            'chcymdy': 'CHC影迷电影',
            'dfys': '东方影视',
            'shxwzh': '上海新闻综合',
            'dycj': '上海第一财经',
            'shjsrw': '上视纪实人文',
            'shics': '上海外语',
            'fztd': '法治天地',
            'jbty': '劲爆体育',
            'mlzq': '魅力足球',
            'ly': '乐游',
            'hxjc': '欢笑剧场',
            'qcxj': '七彩戏剧',
            'yxfy': '游戏风云',
            'lttv': '临洮电视台',
            'jscs': '江苏城市',
            'jszy': '江苏综艺',
            'jsys': '江苏影视',
            'jsggxw': '江苏公共新闻',
            'jsgj': '江苏国际',
            'jsjy': '江苏教育',
            'jstyxx': '江苏体育休闲',
            'ymkt': '优漫卡通',
            'njxwzh': '南京新闻综合',
            'njkj': '南京教科',
            'njsb': '南京十八',
            'haxwzh': '淮安新闻综合',
            'lygxwzh': '连云港新闻综合',
            'szxwzh': '苏州新闻综合',
            'tzxwzh': '泰州新闻综合',
            'sqxwzh': '宿迁新闻综合',
            'xzxwzh': '徐州新闻综合',
            'gdys': '广东影视',
            'gqdp': '高清大片',
            'jdxgdy': '经典深圳旁边电影',
            'jsdp': '军事迷必看大片',
            'ljcwhg': '历届春晚回顾',
            'mg24hty': '咪咕24小时体育台',
            'mglbt': '玫瑰轮播台',
            'ozzqfy': '欧洲足球风云',
            'qmpp': '全民乒乓',
            'rjlb': '热剧联播',
            'sszjd': '赛事最经典',
            'ttmlh': '体坛名栏汇',
            'xpfyt': '新片放映厅',
            'xm1': '熊猫1',
            'xm2': '熊猫2',
            'xm3': '熊猫3',
            'xm4': '熊猫4',
            'xm5': '熊猫5',
            'xm6': '熊猫6',
            'xm7': '熊猫7'
        };

        // 初始化元素引用
        const form = document.getElementById('urlForm');
        const baseUrlInput = document.getElementById('base_url');
        const resultSection = document.getElementById('resultSection');
        const urlList = document.getElementById('urlList');
        const generatedContent = document.getElementById('generatedContent');
        const copyBtn = document.getElementById('copyBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const copiedNotice = document.getElementById('copiedNotice');
        const copyError = document.getElementById('copyError');

        // 表单提交处理
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const baseUrl = baseUrlInput.value.trim();
            if (!baseUrl) return;
            
            // 确保URL以.php结尾
            let processedUrl = baseUrl;
            if (!processedUrl.endsWith('.php')) {
                processedUrl = processedUrl.replace(/\/?$/, '/migu.php');
            }
            
            // 生成URL列表
            generateUrls(processedUrl);
            
            // 显示结果区域
            resultSection.style.display = 'block';
        });

        // 生成URL列表函数
        function generateUrls(baseUrl) {
            // 清空现有列表
            urlList.innerHTML = '';
            let textContent = '';
            
            // 生成每个频道的URL
            for (const [id, name] of Object.entries(channels)) {
                const url = `${baseUrl}?id=${id}`;
                
                // 添加到可视列表
                const li = document.createElement('li');
                li.className = 'url-item';
                // 修改这里：使用英文逗号而不是冒号
                li.innerHTML = `<span class="url-text">${name},${url}</span>`;
                urlList.appendChild(li);
                
                // 添加到文本内容
                // 修改这里：使用英文逗号而不是冒号
                textContent += `${name},${url}\n`;
            }
            
            // 更新隐藏文本区域
            generatedContent.value = textContent;
        }

        // 复制功能
        copyBtn.addEventListener('click', async function() {
            // 重置提示状态
            copiedNotice.style.display = 'none';
            copyError.style.display = 'none';
            
            try {
                const textToCopy = generatedContent.value;
                
                // 方法1：现代浏览器剪贴板API
                if (navigator.clipboard && typeof navigator.clipboard.writeText === 'function') {
                    await navigator.clipboard.writeText(textToCopy);
                    copiedNotice.style.display = 'inline';
                    return;
                }
                
                // 方法2：传统execCommand方法
                const textarea = document.createElement('textarea');
                textarea.value = textToCopy;
                textarea.style.position = 'fixed';
                document.body.appendChild(textarea);
                textarea.select();
                textarea.setSelectionRange(0, textToCopy.length);
                
                const success = document.execCommand('copy');
                document.body.removeChild(textarea);
                
                if (success) {
                    copiedNotice.style.display = 'inline';
                    return;
                }
                
                // 如果所有方法都失败，显示错误提示
                throw new Error('复制失败');
                
            } catch (err) {
                console.error('复制操作出错:', err);
                copyError.style.display = 'block';
            }
        });

        // 下载功能
        downloadBtn.addEventListener('click', function() {
            const text = generatedContent.value;
            const filename = 'migu_live_sources.txt';
            
            // 创建Blob对象
            const blob = new Blob([text], { type: 'text/plain' });
            
            // 创建下载链接
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = filename;
            a.style.display = 'none';
            
            // 添加到文档并触发点击
            document.body.appendChild(a);
            a.click();
            
            // 清理
            setTimeout(function() {
                document.body.removeChild(a);
                URL.revokeObjectURL(a.href);
            }, 100);
        });
    </script>
</body>
</html>